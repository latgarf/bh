#!/usr/bin/env python3

from http import client
from datetime import date
from math import sqrt
import os

from scipy import stats
import math
import datetime, time
import json


BS_DOMAIN = r'www.bitstamp.net'
BS_PATH = r'/api/ticker/'
def getRate():
	conn= client.HTTPSConnection(BS_DOMAIN)
	conn.request('GET', BS_PATH)
	j = json.loads(str(conn.getresponse().read(), 'UTF-8'))
	return float(j['last'])

def bsPrice(s, k, t, v, r, cp):
    # cp = +1/-1 for call/put
    d1 = (math.log(s/k)+(r+0.5*math.pow(v,2))*t)/(v*math.sqrt(t))
    d2 = d1 - v*math.sqrt(t)
    bsprice = cp*s*stats.norm.cdf(cp*d1) - cp*k*math.exp(-r*t)*stats.norm.cdf(cp*d2)
    return bsprice

def getPremium(rate, d, amount) :
    now = date.today()
    n = (d - now).days
    if (n <= 0): n = 1

    s = rate
    k = rate
    r = 0
    v = 0.15

    callPrice = bsPrice(s,k,n,v,r,1)
    putPrice = bsPrice(s,k,n,v,r,-1)
    
    fee_0001 = amount * callPrice / rate
    fee_0002 = amount * putPrice / rate
    fee = fee_0001
    return fee

def getExpriyTime(date):
    exp_time = datetime.datetime(date.year, date.month, date.day) + datetime.timedelta(hours=21)
    return exp_time

if __name__ == '__main__':
	price = getRate();
	print('current price is:', price)
